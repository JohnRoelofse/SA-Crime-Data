library(tidyverse)
library(rlang)
source("crimes function.R")
data <- as.tbl(read.csv2("data/Police_Statistics.csv", header = T, sep = ",", stringsAsFactors = F))
data$Incidents <- as.integer(data$Incidents)
colnames(data) <- c("province", "police_station", "crime", "year", "incidents")

shinyServer(function(input, output){
  output$graph <- renderPlot({
    province <- switch(input$province,
                       "WC"  = "WC")
    
    police <- switch(input$police,
                     "Albertinia" = "Albertinia", 
                     "Ashton" = "Ashton", 
                     "Athlone" = "Athlone", 
                     "Atlantis" = "Atlantis", 
                     "Barrydale" = "Barrydale", 
                     "Beaufort West" = "Beaufort West", 
                     "Belhar" = "Belhar", 
                     "Bellville" = "Bellville",           
                     "Bellville South" = "Bellville South", 
                     "Bishop Lavis" = "Bishop Lavis", 
                     "Bonnievale" = "Bonnievale", 
                     "Bothasig" = "Bothasig",            
                     "Brackenfell" = "Brackenfell",
                     "Bredasdorp" = "Bredasdorp",
                     "Caledon" = "Caledon",
                     "Calitzdorp" = "Calitzdorp",          
                     "Camps Bay" = "Camps Bay",
                     "Cape Town Central" = "Cape Town Central",
                     "Ceres" = "Ceres",
                     "Citrusdal" = "Citrusdal",           
                     "Clanwilliam" = "Clanwilliam",
                     "Claremont" = "Claremont",
                     "Cloetesville" = "Cloetesville",
                     "Conville" = "Conville",            
                     "Da Gamaskop" = "Da Gamaskop",
                     "Darling" = "Darling",
                     "De Doorns" = "De Doorns",
                     "De Rust" = "De Rust",             
                     "Delft" = "Delft",
                     "Dieprivier" = "Dieprivier",
                     "Doring Bay" = "Doring Bay",
                     "Durbanville" = "Durbanville",         
                     "Dysselsdorp" = "Dysselsdorp",
                     "Eendekuil" = "Eendekuil",
                     "Elands Bay" = "Elands Bay",
                     "Elsies River" = "Elsies River",        
                     "Fish Hoek" = "Fish Hoek",
                     "Franschhoek" = "Franschhoek",
                     "Gans Bay" = "Gans Bay",
                     "Genadendal" = "Genadendal",          
                     "George" = "George",
                     "Goodwood" = "Goodwood",
                     "Gordons Bay" = "Gordons Bay",
                     "Graafwater" = "Graafwater",          
                     "Grabouw" = "Grabouw",
                     "Grassy Park" = "Grassy Park",
                     "Groot" = "Groot",
                     "Groot Brakrivier" = "Groot Brakrivier",    
                     "Gugulethu" = "Gugulethu",
                     "Harare" = "Harare",
                     "Heidelberg" = "Heidelberg",
                     "Hermanus" = "Hermanus",
                     "Hopefield" = "Hopefield",
                     "Hout Bay" = "Hout Bay",
                     "Kensington" = "Kensington",
                     "Khayelitsha" = "Khayelitsha",         
                     "Kirstenhof" = "Kirstenhof",
                     "Klapmuts" = "Klapmuts",
                     "Klawer" = "Klawer",
                     "Kleinmond" = "Kleinmond",           
                     "Kleinvlei" = "Kleinvlei",
                     "Knysna" = "Knysna",
                     "Kraaifontein" = "Kraaifontein",
                     "Kuilsrivier" = "Kuilsrivier",         
                     "Kwanokuthula" = "Kwanokuthula",
                     "Kwanonqaba" = "Kwanonqaba",
                     "Laaiplek" = "Laaiplek",
                     "Ladismith" = "Ladismith",           
                     "Laingsburg" = "Laingsburg",
                     "Lambertsbaai" = "Lambertsbaai",
                     "Langa" = "Langa",
                     "Langebaan" = "Langebaan",           
                     "Lansdowne" = "Lansdowne",
                     "Leeu" = "Leeu",
                     "Lentegeur" = "Lentegeur",
                     "Lingelethu" = "Lingelethu",          
                     "Lutzville" = "Lutzville",
                     "Lwandle" = "Lwandle",
                     "Macassar" = "Macassar",
                     "Maitland" = "Maitland",            
                     "Malmesbury" = "Malmesbury",
                     "Manenberg" = "Manenberg",
                     "Mbekweni" = "Mbekweni",
                     "McGregor" = "McGregor",            
                     "Melkbosstrand" = "Melkbosstrand",
                     "Mfuleni" = "Mfuleni",
                     "Milnerton" = "Milnerton",
                     "Mitchells Plain"= "Mitchells Plain",     
                     "Montagu" = "Montagu",
                     "Moorreesburg" = "Moorreesburg",
                     "Mossel Bay" = "Mossel Bay",
                     "Mowbray" = "Mowbray",             
                     "Muizenberg" = "Muizenberg",
                     "Murraysburg" = "Murraysburg",
                     "Napier" = "Napier",
                     "Nuwerus" = "Nuwerus",             
                     "Nyanga" = "Nyanga",
                     "Ocean View" = "Ocean View",
                     "Oudtshoorn" = "Oudtshoorn",
                     "Paarl" = "Paarl",               
                     "Paarl East" = "Paarl East",
                     "Pacaltsdorp" = "Pacaltsdorp",
                     "Parow" = "Parow",
                     "Philadelphia" = "Philadelphia",        
                     "Philippi" = "Philippi",
                     "Philippi East" = "Philippi East",
                     "Piketberg" = "Piketberg",
                     "Pinelands" = "Pinelands",           
                     "Plettenberg Bay" = "Plettenberg Bay",
                     "Porterville" = "Porterville",
                     "Prince Albert" = "Prince Albert",
                     "Prince Alfred Hamlet" = "Prince Alfred Hamlet",
                     "Ravensmead" = "Ravensmead",
                     "Rawsonville" = "Rawsonville",
                     "Redelinghuys" = "Redelinghuys",
                     "Riebeeck West" = "Riebeeck West",       
                     "Riversdale" = "Riversdale",
                     "Riviersonderend" = "Riviersonderend",
                     "Robertson" = "Robertson",
                     "Rondebosch" = "Rondebosch",          
                     "Saldanha" = "Saldanha",
                     "Saron" = "Saron",
                     "Sea Point" = "Sea Point",
                     "Simon" = "Simon",               
                     "Somerset West" = "Somerset West",
                     "St Helena Bay" = "St Helena Bay",
                     "Stanford" = "Stanford",
                     "Steenberg" = "Steenberg",           
                     "Stellenbosch" = "Stellenbosch",
                     "Still Bay" = "Still Bay",
                     "Strand" = "Strand",
                     "Strandfontein" = "Strandfontein",       
                     "Struisbaai" = "Struisbaai",
                     "Suurbraak" = "Suurbraak",
                     "Swellendam" = "Swellendam",
                     "Table Bay Harbour" = "Table Bay Harbour",   
                     "Table View" = "Table View",
                     "Thembalethu" = "Thembalethu",
                     "Touws River" = "Touws River",
                     "Tulbagh" = "Tulbagh",             
                     "Uniondale" = "Uniondale",
                     "Vanrhynsdorp" = "Vanrhynsdorp",
                     "Villiersdorp" = "Villiersdorp",
                     "Vredenburg" = "Vredenburg",          
                     "Vredendal" = "Vredendal",
                     "Wellington" = "Wellington",
                     "Wolseley" = "Wolseley",
                     "Woodstock" = "Woodstock",           
                     "Worcester" = "Worcester",
                     "Wynberg" = "Wynberg")
    
    crime <- switch(input$crime,
                    "All theft not mentioned elsewhere" = "All theft not mentioned elsewhere",
                    "Arson" = "Arson",
                    "Assault with the intent to inflict grievous bodily harm" = "Assault with the intent to inflict grievous bodily harm",
                    "Attempted murder" = "Attempted murder", 
                    "Burglary at non-residential premises" = "Burglary at non-residential premises",
                    "Burglary at residential premises" = "Burglary at residential premises",
                    "Carjacking" = "Carjacking",
                    "Commercial crime" = "Commercial crime",
                    "Common assualt" = "Common assualt",
                    "Common robbery" = "Common robbery",
                    "Crimen injuria" = "Crimen injuria",
                    "Culpable homicide" = "Culpable homicide", 
                    "Driving under the influence of alcohol or drugs" = "Driving under the influence of alcohol or drugs",
                    "Drug-related crime" = "Drug-related crime",
                    "Kidnapping" = "Kidnapping",
                    "Malicious injury to property" = "Malicious injury to property",
                    "Murder" = "Murder",
                    "Neglect and ill-treatment of children" = "Neglect and ill-treatment of children",
                    "Public violence" = "Public violence",
                    "Robbery at non-residential premises" = "Robbery at non-residential premises",
                    "Robbery at residential premises" = "Robbery at residential premises",
                    "Robbery with aggravating circumstances" = "Robbery with aggravating circumstances",
                    "Shoplifting" = "Shoplifting",
                    "Stock-theft" = "Stock-theft",
                    "Theft of motor vehicle and motorcycle" = "Theft of motor vehicle and motorcycle",
                    "Theft out of or from motor vehicle" = "Theft out of or from motor vehicle",
                    "Total Sexual Crimes" = "Total Sexual Crimes",
                    "Truck hijacking" = "Truck hijacking",
                    "Unlawful possession of firearms and ammunition" = "Unlawful possession of firearms and ammunition")
    
    crimes(data = data, 
           x = province, 
           y = police, 
           z = crime)
  })
})